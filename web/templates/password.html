{{define "title"}}Password{{end}}

{{define "content"}}
<h1>Password</h1>
<div class="password-container">
	{{if .Token}}
		<h2>Reset Password</h2>
		<form id="resetForm">
			<input type="hidden" name="token" value="{{.Token}}" />
			<div class="form-group">
				<label for="password">New Password</label>
				<input type="password" id="password" name="password" minlength="8" required />
			</div>
			<button type="submit">Update Password</button>
		</form>
		<div id="resetMsg" class="error-message"></div>
	{{else}}
		<h2>Forgot Password</h2>
		<form id="forgotForm">
			<div class="form-group">
				<label for="email">Email</label>
				<input type="email" id="email" name="email" required />
			</div>
			<button type="submit">Send Reset Email</button>
		</form>
		<div id="forgotMsg" class="error-message"></div>
	{{end}}
</div>
{{end}}

{{define "scripts"}}
<script>
document.addEventListener('DOMContentLoaded', () => {
	const forgotForm = document.getElementById('forgotForm');
	const resetForm = document.getElementById('resetForm');
	if (forgotForm) {
		forgotForm.addEventListener('submit', (e) => {
			e.preventDefault();
			const data = new URLSearchParams(new FormData(forgotForm));
			fetch('/forgot-password', { method: 'POST', headers: {'Content-Type':'application/x-www-form-urlencoded'}, body: data.toString() })
				.then(r => r.text()).then(t => { document.getElementById('forgotMsg').textContent = 'If the email exists, a reset was sent.'; });
		});
	}
	if (resetForm) {
		resetForm.addEventListener('submit', (e) => {
			e.preventDefault();
			const data = new URLSearchParams(new FormData(resetForm));
			fetch('/reset-password', { method: 'POST', headers: {'Content-Type':'application/x-www-form-urlencoded'}, body: data.toString() })
				.then(r => r.text()).then(() => { document.getElementById('resetMsg').textContent = 'Password updated. You can now login.'; });
		});
	}
});
</script>
{{end}}

{{template "base" .}}
